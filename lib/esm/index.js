import{__awaiter as e,__generator as t}from"./_virtual/_tslib.js";import r from"inquirer";import n from"chalk";import o from"open";import{hasFileOrDir as s,appendFileContent as c,writeFileContent as l,readFileContent as i}from"./file.js";import{setAes as a,encrypt as u,createAes as d,decrypt as p,del as v}from"./aes.js";import{Encryption as y}from"./types.js";import{setRsa as f,encrypt as g,createRsa as m,decrypt as b,del as h}from"./rsa.js";import{getPath as w,getCodeBookPath as O}from"./utils.js";var typeOptions=new Map([[y.AES,{set:a,encrypt:u,create:d,decrypt:p,del:v}],[y.RSA,{set:f,encrypt:g,create:m,decrypt:b,del:h}]]),set=function(n){return e(void 0,void 0,void 0,function(){var e,o,c,l,i;return t(this,function(t){switch(t.label){case 0:return e=w(n),[4,s(e)];case 1:if(!t.sent())return[3,3];return[4,r.prompt([{type:"confirm",name:"overwrite",message:"File already exists. Overwrite?"}])];case 2:return t.sent().overwrite?null===(c=null===(o=typeOptions.get(n))||void 0===o?void 0:o.set)||void 0===c||c.call(o):process.exit(1),[3,4];case 3:null===(i=null===(l=typeOptions.get(n))||void 0===l?void 0:l.set)||void 0===i||i.call(l),t.label=4;case 4:return[2]}})})},encrypt=function(r,o,l,a){return void 0===o&&(o=y.AES),e(void 0,void 0,void 0,function(){var e,u,d,p,v,y,f,g,m,b,h,k,A,x;return t(this,function(t){switch(t.label){case 0:return e=w(o),u=O(),[4,s(e)];case 1:if(d=t.sent(),"string"!=typeof l)return[3,4];return[4,null===(g=null===(f=typeOptions.get(o))||void 0===f?void 0:f.encrypt)||void 0===g?void 0:g.call(f,l,r)];case 2:case 6:case 10:return p=t.sent(),[4,c(u,"".concat(a||"unknown",": ").concat(p))];case 3:case 7:return t.sent(),console.log(n.green("Encryption successful.")),console.log(n.yellow("Your  encrypted code:"+n.green(p))),[3,12];case 4:if(!d)return[3,8];return[4,i(e)];case 5:return v=t.sent(),[4,null===(b=null===(m=typeOptions.get(o))||void 0===m?void 0:m.encrypt)||void 0===b?void 0:b.call(m,v,r)];case 8:return[4,null===(k=null===(h=typeOptions.get(o))||void 0===h?void 0:h.create)||void 0===k?void 0:k.call(h)];case 9:return y=t.sent()||"",[4,null===(x=null===(A=typeOptions.get(o))||void 0===A?void 0:A.encrypt)||void 0===x?void 0:x.call(A,y,r)];case 11:t.sent(),console.log(n.green("Encryption successful.")),console.log(n.yellow("Your  encrypted code:"+n.green(p))),t.label=12;case 12:return[2]}})})},decrypt=function(r,o,c){return void 0===o&&(o=y.AES),e(void 0,void 0,void 0,function(){var e,l,a,u,d,p,v,f;return t(this,function(t){switch(t.label){case 0:return e=w(o===y.RSA?"".concat(o,".private"):o),[4,s(e)];case 1:if(l=t.sent(),"string"!=typeof c)return[3,3];return[4,null===(p=null===(d=typeOptions.get(o))||void 0===d?void 0:d.decrypt)||void 0===p?void 0:p.call(d,c,r)];case 2:case 5:return a=t.sent(),console.log(n.green("Decryption successful.")),console.log(n.yellow("Your  encrypted code:")+n.green(a)),[3,7];case 3:if(!l)return[3,6];return[4,i(e)];case 4:return u=t.sent(),[4,null===(f=null===(v=typeOptions.get(o))||void 0===v?void 0:v.decrypt)||void 0===f?void 0:f.call(v,u,r)];case 6:console.log(n.yellow("You have not yet set up the decryption private key")),t.label=7;case 7:return[2]}})})},del=function(o){return void 0===o&&(o=y.AES),e(void 0,void 0,void 0,function(){var e,c,l;return t(this,function(t){switch(t.label){case 0:return e=w(o===y.RSA?"".concat(o,".private"):o),[4,s(e)];case 1:if(!t.sent())return[3,5];return[4,r.prompt([{type:"confirm",name:"deleteKey",message:"Are you sure you want to delete the public/private key?"}])];case 2:if(!t.sent().deleteKey)return[3,4];return[4,null===(l=null===(c=typeOptions.get(o))||void 0===c?void 0:c.del)||void 0===l?void 0:l.call(c)];case 3:t.sent(),console.log(n.green("Deletion successful.")),t.label=4;case 4:return[3,6];case 5:console.log("The specified type of public/private key has not been generated locally."),t.label=6;case 6:return[2]}})})},exp=function(r){return e(void 0,void 0,void 0,function(){var e,c;return t(this,function(t){switch(t.label){case 0:return e=O(),[4,s(e)];case 1:if(!t.sent())return[3,7];t.label=2;case 2:return t.trys.push([2,5,,6]),[4,i(e)];case 3:return c=t.sent(),[4,l("".concat(r,"/code-book.txt"),c)];case 4:return t.sent(),console.log(n.green("Password book exported successfully.")),o(r),[3,6];case 5:return console.log(t.sent()),[3,6];case 6:return[3,8];case 7:console.log("Password book is not saved locally."),t.label=8;case 8:return[2]}})})};export{decrypt,del,encrypt,exp,set};
